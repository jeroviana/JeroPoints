<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Jero Points</title>
<style>
Â  @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@500&display=swap');
Â  /* Paleta rosa y arcoiris */
Â  :root {
Â  Â  --rosa: #ff66b2;
Â  Â  --rosa-claro: #ffe6f0;
Â  Â  --rojo: #ff4d4d;
Â  Â  --naranja: #ff9933;
Â  Â  --amarillo: #ffcc00;
Â  Â  --verde: #33cc66;
Â  Â  --celeste: #66ccff;
Â  Â  --azul: #3399ff;
Â  Â  --lila: #cc99ff;
Â  Â  --gris-claro: #f9f9f9;
Â  Â  --gris-medio: #ddd;
Â  Â  --gris-oscuro: #666;
Â  }
Â  body {
Â  Â  font-family: 'Quicksand', sans-serif;
Â  Â  background: var(--rosa-claro);
Â  Â  color: #333;
Â  Â  margin: 0;
Â  Â  padding: 1rem 2rem 3rem 2rem;
Â  Â  min-height: 100vh;
Â  Â  user-select: none;
Â  }
Â  h1, h2, h3 {
Â  Â  color: var(--rosa);
Â  Â  margin-bottom: 0.5rem;
Â  Â  text-align: center;
Â  }
Â  h1 {
Â  Â  font-size: 2.8rem;
Â  Â  margin-bottom: 1rem;
Â  Â  text-shadow:
Â  Â  Â  1px 1px var(--rojo),
Â  Â  Â  2px 2px var(--naranja),
Â  Â  Â  3px 3px var(--amarillo),
Â  Â  Â  4px 4px var(--verde),
Â  Â  Â  5px 5px var(--celeste),
Â  Â  Â  6px 6px var(--azul),
Â  Â  Â  7px 7px var(--lila);
Â  }
Â  main {
Â  Â  max-width: 900px;
Â  Â  margin: auto;
Â  Â  background: white;
Â  Â  border-radius: 15px;
Â  Â  box-shadow:
Â  Â  Â  0 0 8px var(--rosa),
Â  Â  Â  0 0 25px var(--lila);
Â  Â  padding: 1.5rem 2rem 2rem 2rem;
Â  }

Â  /* Botones */
Â  button {
Â  Â  background: var(--rosa);
Â  Â  border: none;
Â  Â  color: white;
Â  Â  font-weight: 600;
Â  Â  padding: 0.45rem 1rem;
Â  Â  border-radius: 25px;
Â  Â  cursor: pointer;
Â  Â  transition: background 0.3s ease;
Â  Â  box-shadow: 0 0 8px var(--rosa);
Â  Â  user-select: none;
Â  }
Â  button:hover, button:focus {
Â  Â  background: var(--rojo);
Â  Â  outline: none;
Â  Â  box-shadow:
Â  Â  Â  0 0 15px var(--rojo),
Â  Â  Â  0 0 35px var(--naranja);
Â  }

Â  /* Botones info */
Â  .btn-info-list {
Â  Â  background: linear-gradient(90deg, var(--rojo), var(--naranja), var(--amarillo), var(--verde), var(--celeste), var(--azul), var(--lila));
Â  Â  font-weight: 700;
Â  Â  font-size: 0.95rem;
Â  Â  box-shadow: 0 0 12px var(--lila);
Â  Â  margin-right: 1rem;
Â  Â  user-select:none;
Â  }
Â  .btn-info-list:hover, .btn-info-list:focus {
Â  Â  filter: brightness(1.2);
Â  }

Â  /* Toggle modo admin */
Â  #toggleAdminBtn {
Â  Â  position: fixed;
Â  Â  top: 12px;
Â  Â  right: 12px;
Â  Â  z-index: 1001;
Â  Â  padding: 0.45rem 1rem;
Â  Â  font-size: 1rem;
Â  Â  box-shadow:
Â  Â  Â  0 0 12px var(--rosa);
Â  }

Â  /* Formulario modo admin */
Â  #adminPanel {
Â  Â  background: var(--rosa-claro);
Â  Â  border: 2px solid var(--rosa);
Â  Â  border-radius: 15px;
Â  Â  padding: 1rem;
Â  Â  margin-bottom: 1rem;
Â  Â  box-shadow: 0 0 15px var(--lila);
Â  }
Â  form label {
Â  Â  display: block;
Â  Â  font-weight: 600;
Â  Â  margin-top: 0.8rem;
Â  Â  margin-bottom: 0.25rem;
Â  Â  color: var(--rosa);
Â  }
Â  input[type="text"], input[type="number"], input[type="password"] {
Â  Â  width: 100%;
Â  Â  padding: 0.5rem 0.6rem;
Â  Â  border: 2px solid var(--rosa);
Â  Â  border-radius: 10px;
Â  Â  font-size: 1rem;
Â  Â  font-family: inherit;
Â  }
Â  input[type="text"]:focus, input[type="number"]:focus, input[type="password"]:focus {
Â  Â  outline: none;
Â  Â  border-color: var(--rojo);
Â  Â  box-shadow: 0 0 8px var(--rojo);
Â  }
Â  .form-row {
Â  Â  margin-bottom: 0.6rem;
Â  }
Â  .btn-submit {
Â  Â  margin-top: 1rem;
Â  Â  width: 100%;
Â  }
Â  #pointsGivenList, #gananListAdmin, #pierdenListAdmin {
Â  Â  max-height: 150px;
Â  Â  overflow-y: auto;
Â  Â  border: 1.5px solid var(--rosa);
Â  Â  border-radius: 10px;
Â  Â  background: var(--rosa-claro);
Â  Â  padding: 0.6rem 1rem;
Â  Â  box-shadow: inset 0 0 6px var(--lila);
Â  }
Â  .list-item {
Â  Â  background: white;
Â  Â  border-radius: 12px;
Â  Â  margin-bottom: 0.4rem;
Â  Â  padding: 0.3rem 0.6rem;
Â  Â  display: flex;
Â  Â  justify-content: space-between;
Â  Â  align-items: center;
Â  Â  font-weight: 500;
Â  Â  color: var(--gris-oscuro);
Â  }
Â  .list-item button {
Â  Â  background: var(--rojo);
Â  Â  padding: 0 8px;
Â  Â  border-radius: 100%;
Â  Â  font-weight: 700;
Â  Â  box-shadow: none;
Â  Â  font-size: 0.9rem;
Â  Â  transition: background 0.25s ease;
Â  }
Â  .list-item button:hover {
Â  Â  background: var(--naranja);
Â  Â  color: white;
Â  }

Â  /* Tabla ranking */
Â  table {
Â  Â  width: 100%;
Â  Â  border-collapse: collapse;
Â  Â  margin-top: 0.7rem;
Â  }
Â  caption {
Â  Â  text-align: left;
Â  Â  font-weight: 700;
Â  Â  color: var(--rosa);
Â  Â  margin-bottom: 0.3rem;
Â  }
Â  thead tr {
Â  Â  background: linear-gradient(90deg, var(--rojo), var(--naranja), var(--amarillo), var(--verde), var(--celeste), var(--azul), var(--lila));
Â  Â  color: white;
Â  Â  font-weight: 700;
Â  }
Â  tbody tr {
Â  Â  cursor: pointer;
Â  Â  transition: background 0.3s ease;
Â  }
Â  tbody tr:hover, tbody tr:focus-within {
Â  Â  background: var(--rosa-claro);
Â  }
Â  th, td {
Â  Â  padding: 0.5rem 0.75rem;
Â  Â  border-bottom: 1px solid var(--gris-medio);
Â  Â  text-align: left;
Â  }
Â  th:first-child, td:first-child {
Â  Â  text-align: center;
Â  Â  width: 5%;
Â  }
Â  th:nth-child(2), td:nth-child(2) {
Â  Â  width: 45%;
Â  }
Â  th:nth-child(3), td:nth-child(3) {
Â  Â  width: 20%;
Â  Â  text-align: center;
Â  }

Â  /* Medallas de los 3 primeros */
Â  .medalla {
Â  Â  font-size: 1.3rem;
Â  Â  margin-right: 8px;
Â  Â  vertical-align: middle;
Â  }
Â  .oro {
Â  Â  color: #FFD700;
Â  Â  text-shadow:
Â  Â  Â  1px 1px 2px #b38700;
Â  }
Â  .plata {
Â  Â  color: #C0C0C0;
Â  Â  text-shadow:
Â  Â  Â  1px 1px 2px #777;
Â  }
Â  .bronce {
Â  Â  color: #cd7f32;
Â  Â  text-shadow:
Â  Â  Â  1px 1px 2px #7a4f1e;
Â  }

Â  /* Detalle puntos */
Â  #detailsSection {
Â  Â  margin-top: 1.2rem;
Â  Â  background: var(--rosa-claro);
Â  Â  border-radius: 15px;
Â  Â  padding: 1rem;
Â  Â  box-shadow: 0 0 12px var(--lila);
Â  }
Â  #detailsBody td, #detailsBody th {
Â  Â  padding: 0.4rem 0.8rem;
Â  }
Â  #detailsBody tr:hover {
Â  Â  background: var(--rosa);
Â  Â  color: white;
Â  }
Â  #detailsBody button {
Â  Â  background: var(--rojo);
Â  Â  padding: 0.2rem 0.5rem;
Â  Â  border-radius: 6px;
Â  Â  font-weight: 600;
Â  Â  font-size: 0.85rem;
Â  Â  display: none; /* Oculto por defecto, se muestra en admin */
Â  Â  cursor: pointer;
Â  }
Â  #detailsBody button.show-in-admin {
Â  Â  display: inline-block;
Â  }
Â  #closeDetailsBtn {
Â  Â  margin-top: 0.7rem;
Â  Â  background: var(--lila);
Â  Â  color: var(--rosa);
Â  Â  font-weight: 700;
Â  }

Â  /* Info botones */
Â  #pointsInfoList {
Â  Â  margin-top: 0.8rem;
Â  Â  padding: 0.7rem 1rem;
Â  Â  background: var(--rosa-claro);
Â  Â  border-radius: 12px;
Â  Â  box-shadow: inset 0 0 8px var(--lila);
Â  Â  max-height: 180px;
Â  Â  overflow-y: auto;
Â  }

Â  /* Oculto y visible */
Â  .hidden {
Â  Â  display: none !important;
Â  }

Â  /* Modal contraseÃ±a */
Â  #passwordModal {
Â  Â  position: fixed;
Â  Â  top: 50%;
Â  Â  left: 50%;
Â  Â  transform: translate(-50%, -50%);
Â  Â  background: var(--rosa-claro);
Â  Â  border: 2px solid var(--rosa);
Â  Â  box-shadow: 0 0 25px var(--lila);
Â  Â  border-radius: 15px;
Â  Â  padding: 1.3rem 2rem;
Â  Â  z-index: 9999;
Â  Â  max-width: 320px;
Â  Â  width: 90%;
Â  Â  display: none;
Â  }
Â  #passwordModal.show {
Â  Â  display: block;
Â  }
Â  #adminPasswordInput {
Â  Â  width: 100%;
Â  Â  padding: 0.6rem 0.7rem;
Â  Â  font-size: 1.2rem;
Â  Â  border-radius: 12px;
Â  Â  border: 2px solid var(--rosa);
Â  Â  margin-top: 0.8rem;
Â  Â  outline-offset: 2px;
Â  }
Â  #adminLoginBtn {
Â  Â  margin-top: 1rem;
Â  Â  width: 100%;
Â  }
Â  #passwordError {
Â  Â  color: var(--rojo);
Â  Â  font-weight: 700;
Â  Â  margin-top: 0.6rem;
Â  Â  text-align: center;
Â  Â  display: none;
Â  }

Â  /* Responsive */
Â  @media (max-width: 600px) {
Â  Â  body {
Â  Â  Â  padding: 1rem 1rem 2rem 1rem;
Â  Â  }
Â  Â  main {
Â  Â  Â  padding: 1rem 1rem 1.5rem 1rem;
Â  Â  }
Â  Â  #adminPanel {
Â  Â  Â  padding: 1rem;
Â  Â  }
Â  Â  table, th, td {
Â  Â  Â  font-size: 0.9rem;
Â  Â  }
Â  Â  .btn-info-list {
Â  Â  Â  font-size: 0.85rem;
Â  Â  Â  margin-bottom: 0.6rem;
Â  Â  Â  width: 48%;
Â  Â  }
Â  }
</style>
</head>
<body>

<button id="toggleAdminBtn" aria-pressed="false" aria-label="Activar modo organizadora">Modo Organizadora ğŸ”</button>

<main>
Â  <h1>Jero Points</h1>

Â  Â  <section id="adminPanel" class="hidden" aria-live="polite" aria-atomic="true" aria-label="Panel de modo organizadora">
Â  Â  <form id="addPointsForm" aria-label="Formulario para agregar puntos">
Â  Â  Â  <div class="form-row">
Â  Â  Â  Â  <label for="nameInput">Nombre de hermana</label>
Â  Â  Â  Â  <input id="nameInput" type="text" autocomplete="off" placeholder="Ej: Sol Volpe" required />
Â  Â  Â  </div>
Â  Â  Â  <div class="form-row">
Â  Â  Â  Â  <label for="pointsInput">Cantidad de puntos</label>
Â  Â  Â  Â  <input id="pointsInput" type="number" step="1" required />
Â  Â  Â  </div>
Â  Â  Â  <div class="form-row">
Â  Â  Â  Â  <label for="reasonInput">Motivo</label>
Â  Â  Â  Â  <input id="reasonInput" type="text" autocomplete="off" placeholder="Ej: Excelente exposiciÃ³n" required />
Â  Â  Â  </div>
Â  Â  Â  <button type="submit" class="btn-submit">Agregar puntos</button>
Â  Â  </form>

Â  Â  <h3>Lista de puntos dados</h3>
Â  Â  <div id="pointsGivenList" aria-live="polite" aria-atomic="true">
Â  Â  Â  Â  Â  </div>

Â  Â  <h2>Administrar motivos</h2>
Â  Â  <div style="display:flex; gap: 1.5rem; flex-wrap: wrap;">
Â  Â  Â  <div style="flex: 1 1 48%;">
Â  Â  Â  Â  <h3>Â¿CÃ³mo se ganan puntos?</h3>
Â  Â  Â  Â  <form id="formGanan" aria-label="Agregar motivo para ganar puntos">
Â  Â  Â  Â  Â  <input id="gananMotivoInput" type="text" placeholder="Nuevo motivo..." autocomplete="off" required />
Â  Â  Â  Â  Â  <input id="gananPuntosInput" type="number" min="1" step="1" placeholder="Puntos" required />
Â  Â  Â  Â  Â  <button type="submit">Agregar</button>
Â  Â  Â  Â  </form>
Â  Â  Â  Â  <div id="gananListAdmin" class="points-list" aria-live="polite" aria-atomic="true"></div>
Â  Â  Â  </div>
Â  Â  Â  <div style="flex: 1 1 48%;">
Â  Â  Â  Â  <h3>Â¿CÃ³mo se pierden puntos?</h3>
Â  Â  Â  Â  <form id="formPierden" aria-label="Agregar motivo para perder puntos">
Â  Â  Â  Â  Â  <input id="pierdenMotivoInput" type="text" placeholder="Nuevo motivo..." autocomplete="off" required />
Â  Â  Â  Â  Â  <input id="pierdenPuntosInput" type="number" min="1" step="1" placeholder="Puntos" required />
Â  Â  Â  Â  Â  <button type="submit">Agregar</button>
Â  Â  Â  Â  </form>
Â  Â  Â  Â  <div id="pierdenListAdmin" class="points-list" aria-live="polite" aria-atomic="true"></div>
Â  Â  Â  </div>
Â  Â  </div>
Â  </section>

Â  Â  <section aria-label="Tabla de posiciones de Jero Points">
Â  Â  <h2 class="section-title">Ranking de Jero Points âœ¨</h2>
Â  Â  <table aria-describedby="rankingDescription" role="table" style="table-layout:fixed;">
Â  Â  Â  <caption id="rankingDescription" class="sr-only">Tabla con nombres de hermanas y sus puntos</caption>
Â  Â  Â  <thead>
Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  <th style="width: 5%;">#</th>
Â  Â  Â  Â  Â  <th style="width: 45%;">Nombre</th>
Â  Â  Â  Â  Â  <th style="width: 20%;">Puntos</th>
Â  Â  Â  Â  </tr>
Â  Â  Â  </thead>
Â  Â  Â  <tbody id="rankingBody" role="rowgroup" aria-live="polite" aria-relevant="all">
Â  Â  Â  Â  Â  Â  Â  </tbody>
Â  Â  </table>

Â  Â  <div id="detailsSection" class="hidden" aria-live="polite" aria-atomic="true" style="margin-top:1.2rem;">
Â  Â  Â  <h3>Detalle de puntos</h3>
Â  Â  Â  <table role="table" aria-describedby="detailsDescription" style="table-layout: fixed; width: 100%;">
Â  Â  Â  Â  <caption id="detailsDescription" class="sr-only">Detalle de puntos ganados o perdidos por motivo y fecha</caption>
Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  <th style="width: 25%;">Fecha</th>
Â  Â  Â  Â  Â  Â  <th style="width: 15%;">Puntos</th>
Â  Â  Â  Â  Â  Â  <th style="width: 45%;">Motivo</th>
Â  Â  Â  Â  Â  Â  <th style="width: 15%;">AcciÃ³n</th>
Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  </thead>
Â  Â  Â  Â  <tbody id="detailsBody">
Â  Â  Â  Â  Â  Â  Â  Â  Â  </tbody>
Â  Â  Â  </table>
Â  Â  Â  <button id="closeDetailsBtn" style="margin-top:0.5rem;">Cerrar detalle</button>
Â  Â  </div>
Â  </section>

Â  <div style="margin-top:1.5rem; user-select:none; text-align:center;">
Â  Â  <button class="btn-info-list" id="showPointsInfoBtn" aria-expanded="false" aria-controls="pointsInfoList">Â¿CÃ³mo se ganan puntos?</button>
Â  Â  <button class="btn-info-list" id="showPointsLostBtn" aria-expanded="false" aria-controls="pointsInfoList">Â¿CÃ³mo se pierden puntos?</button>
Â  Â  <div id="pointsInfoList" class="points-list hidden" role="region" aria-live="polite" aria-atomic="true" style="margin-top:0.7rem;"></div>
Â  </div>
</main>

<div id="passwordModal" class="password-container" role="dialog" aria-modal="true" aria-labelledby="modalTitle" aria-hidden="true" style="display:none;">
Â  <h3 id="modalTitle" style="color: var(--rosa);">Modo Organizadora - IngresÃ¡ la contraseÃ±a</h3>
Â  <input type="password" id="adminPasswordInput" aria-describedby="passwordHelp" placeholder="ContraseÃ±a" autocomplete="off" />
Â  <button id="adminLoginBtn">Entrar</button>
Â  <div id="passwordError" class="error-msg" role="alert" aria-live="assertive" style="display:none; color: var(--rojo); font-weight: 700; margin-top: 0.5rem; text-align:center;">
Â  Â  ContraseÃ±a incorrecta. Intenta de nuevo.
Â  </div>
</div>

<script>
(() => {
Â  const PASSWORD = "jeroforlife";
Â  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyqHwYNgdAznaIrE8YihDPXlpzWdhbUWTIqrfMDQs2vEKij2Acyu0pyMtX6JSP3EziySQ/exec";

Â  // Estado global
Â  let isAdmin = false;
Â  let data = []; // Array de objetos {nombre, puntos, detalles: [{fecha, puntos, motivo, id}]}
Â  
Â  // Usamos localStorage para los motivos porque no se guardan en Sheets.
Â  let puntosGanadosMotivos = JSON.parse(localStorage.getItem("puntosGanadosMotivos")) || [
Â  Â  { motivo: "Saber de memoria su parte", puntos: 5 },
Â  Â  { motivo: "Exponer bien", puntos: 3 },
Â  Â  { motivo: "Actitud positiva", puntos: 2 },
Â  ];
Â  let puntosPerdidosMotivos = JSON.parse(localStorage.getItem("puntosPerdidosMotivos")) || [
Â  Â  { motivo: "Faltar a reuniÃ³n sin aviso", puntos: 4 },
Â  Â  { motivo: "No preparar tarea", puntos: 3 },
Â  Â  { motivo: "Interrumpir a otra hermana", puntos: 1 },
Â  ];

Â  // Para dar ID Ãºnico a cada entrada de puntos
Â  let nextDetailId = 1;

Â  // Elementos DOM
Â  const toggleAdminBtn = document.getElementById("toggleAdminBtn");
Â  const adminPanel = document.getElementById("adminPanel");
Â  const passwordModal = document.getElementById("passwordModal");
Â  const adminPasswordInput = document.getElementById("adminPasswordInput");
Â  const adminLoginBtn = document.getElementById("adminLoginBtn");
Â  const passwordError = document.getElementById("passwordError");

Â  const rankingBody = document.getElementById("rankingBody");
Â  const detailsSection = document.getElementById("detailsSection");
Â  const detailsBody = document.getElementById("detailsBody");
Â  const closeDetailsBtn = document.getElementById("closeDetailsBtn");

Â  const pointsGivenList = document.getElementById("pointsGivenList");

Â  const showPointsInfoBtn = document.getElementById("showPointsInfoBtn");
Â  const showPointsLostBtn = document.getElementById("showPointsLostBtn");
Â  const pointsInfoList = document.getElementById("pointsInfoList");

Â  const formAddPoints = document.getElementById("addPointsForm");
Â  const nameInput = document.getElementById("nameInput");
Â  const pointsInput = document.getElementById("pointsInput");
Â  const reasonInput = document.getElementById("reasonInput");

Â  // Formularios admin motivos
Â  const formGanan = document.getElementById("formGanan");
Â  const gananMotivoInput = document.getElementById("gananMotivoInput");
Â  const gananPuntosInput = document.getElementById("gananPuntosInput");
Â  const gananListAdmin = document.getElementById("gananListAdmin");

Â  const formPierden = document.getElementById("formPierden");
Â  const pierdenMotivoInput = document.getElementById("pierdenMotivoInput");
Â  const pierdenPuntosInput = document.getElementById("pierdenPuntosInput");
Â  const pierdenListAdmin = document.getElementById("pierdenListAdmin");

Â  // FunciÃ³n para mostrar el modal contraseÃ±a
Â  function showPasswordModal() {
Â  Â  passwordError.style.display = "none";
Â  Â  adminPasswordInput.value = "";
Â  Â  passwordModal.style.display = "block";
Â  Â  passwordModal.setAttribute("aria-hidden", "false");
Â  Â  adminPasswordInput.focus();
Â  }

Â  // FunciÃ³n para ocultar modal
Â  function hidePasswordModal() {
Â  Â  passwordModal.style.display = "none";
Â  Â  passwordModal.setAttribute("aria-hidden", "true");
Â  }

Â  // Al hacer click en el botÃ³n modo admin, pedir contraseÃ±a
Â  toggleAdminBtn.addEventListener("click", () => {
Â  Â  if (isAdmin) {
Â  Â  Â  // Salir del modo admin
Â  Â  Â  isAdmin = false;
Â  Â  Â  adminPanel.classList.add("hidden");
Â  Â  Â  toggleAdminBtn.textContent = "Modo Organizadora ğŸ”";
Â  Â  Â  toggleAdminBtn.setAttribute("aria-pressed", "false");
Â  Â  Â  hidePasswordModal();
Â  Â  Â  renderRanking();
Â  Â  Â  renderPointsGiven();
Â  Â  Â  renderInfoList(); // refrescar info en modo normal
Â  Â  } else {
Â  Â  Â  showPasswordModal();
Â  Â  }
Â  });

Â  // Ingreso contraseÃ±a
Â  adminLoginBtn.addEventListener("click", () => {
Â  Â  const val = adminPasswordInput.value.trim();
Â  Â  if (val === PASSWORD) {
Â  Â  Â  isAdmin = true;
Â  Â  Â  adminPanel.classList.remove("hidden");
Â  Â  Â  toggleAdminBtn.textContent = "Salir Modo Organizadora âŒ";
Â  Â  Â  toggleAdminBtn.setAttribute("aria-pressed", "true");
Â  Â  Â  hidePasswordModal();
Â  Â  Â  renderRanking();
Â  Â  Â  renderPointsGiven();
Â  Â  Â  renderMotivos();
Â  Â  } else {
Â  Â  Â  passwordError.style.display = "block";
Â  Â  Â  adminPasswordInput.focus();
Â  Â  }
Â  });
Â  adminPasswordInput.addEventListener("keydown", (e) => {
Â  Â  if (e.key === "Enter") {
Â  Â  Â  adminLoginBtn.click();
Â  Â  }
Â  });
Â  
Â  // Guardar motivos en localStorage
Â  function saveMotivos() {
Â  Â  localStorage.setItem("puntosGanadosMotivos", JSON.stringify(puntosGanadosMotivos));
Â  Â  localStorage.setItem("puntosPerdidosMotivos", JSON.stringify(puntosPerdidosMotivos));
Â  }

Â  // -------------------------------------------------------------
Â  // Funciones de Carga y Guardado de datos para Google Sheets
Â  // -------------------------------------------------------------

Â  // Guardar un nuevo registro en Google Sheets
Â  async function savePointToSheet(entry) {
Â  Â  try {
Â  Â  Â  const response = await fetch(SCRIPT_URL, {
Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  headers: {
Â  Â  Â  Â  Â  'Content-Type': 'application/json',
Â  Â  Â  Â  },
Â  Â  Â  Â  body: JSON.stringify({ ...entry, action: 'addPoints' }),
Â  Â  Â  });
Â  Â  Â  await response.json();
Â  Â  } catch (error) {
Â  Â  Â  console.error('Error al guardar datos en Google Sheets:', error);
Â  Â  Â  alert("Hubo un error al guardar los puntos. Por favor, revisa la configuraciÃ³n de Google Apps Script.");
Â  Â  }
Â  }

Â  // Cargar todos los datos desde Google Sheets
Â  async function loadData() {
Â  Â  try {
Â  Â  Â  const response = await fetch(SCRIPT_URL);
Â  Â  Â  const rawData = await response.json();
Â  Â  Â  
Â  Â  Â  // Procesar los datos de la hoja para generar el ranking y los detalles
Â  Â  Â  const processedData = rawData.reduce((acc, row) => {
Â  Â  Â  Â  const nombre = row.Nombre;
Â  Â  Â  Â  const puntos = Number(row.Puntos);
Â  Â  Â  Â  const motivo = row.Motivo;
Â  Â  Â  Â  const fecha = row.Fecha;
Â  Â  Â  Â  const id = Number(row.ID);
Â  Â  Â  Â  
Â  Â  Â  Â  let user = acc.find(u => u.nombre.toLowerCase() === nombre.toLowerCase());
Â  Â  Â  Â  if (!user) {
Â  Â  Â  Â  Â  user = { nombre: nombre, puntos: 0, detalles: [] };
Â  Â  Â  Â  Â  acc.push(user);
Â  Â  Â  Â  }
Â  Â  Â  Â  user.puntos += puntos;
Â  Â  Â  Â  user.detalles.push({ fecha, puntos, motivo, id });
Â  Â  Â  Â  return acc;
Â  Â  Â  }, []);
Â  Â  Â  
Â  Â  Â  data = processedData;

Â  Â  Â  // Actualizar el ID para nuevos registros
Â  Â  Â  nextDetailId = data.reduce((max, user) => {
Â  Â  Â  Â  const maxId = user.detalles.reduce((maxDet, det) => Math.max(maxDet, det.id), 0);
Â  Â  Â  Â  return Math.max(max, maxId);
Â  Â  Â  }, 0) + 1;
Â  Â  Â  
Â  Â  Â  renderRanking();
Â  Â  Â  renderPointsGiven();

Â  Â  } catch (error) {
Â  Â  Â  console.error('Error al cargar datos desde Google Sheets:', error);
Â  Â  Â  alert("No se pudieron cargar los datos desde Google Sheets. Revisa la URL y los permisos.");
Â  Â  Â  data = [];
Â  Â  }
Â  }

Â  // Agregar puntos nuevo
Â  async function addPoints(nombre, puntos, motivo) {
Â  Â  const fecha = new Date().toLocaleDateString("es-PY");
Â  Â  const newDetailId = nextDetailId++;
Â  Â  const newEntry = { nombre, puntos, motivo, fecha, id: newDetailId };
Â  Â  
Â  Â  await savePointToSheet(newEntry);
Â  Â  await loadData(); // Recargar todos los datos para ver la actualizaciÃ³n
Â  }

Â  // Borrar punto dado (modo admin)
Â  function removePoint(nombre, id) {
Â  Â  const user = data.find((d) => d.nombre.toLowerCase() === nombre.toLowerCase());
Â  Â  if (!user) return;
Â  Â  const idx = user.detalles.findIndex((det) => det.id === id);
Â  Â  if (idx === -1) return;
Â  Â  // Restar puntos antes de eliminar
Â  Â  user.puntos -= user.detalles[idx].puntos;
Â  Â  user.detalles.splice(idx, 1);
Â  Â  if (user.detalles.length === 0 && user.puntos === 0) {
Â  Â  Â  // Si el usuario no tiene puntos ni registros, lo eliminamos del ranking
Â  Â  Â  data = data.filter(d => d.nombre !== user.nombre);
Â  Â  }
Â  Â  // Nota: Este cambio no se guardarÃ¡ en Google Sheets. Para esto,
Â  Â  // se necesitarÃ­a una funciÃ³n adicional en Apps Script que permita borrar filas.
Â  Â  renderRanking();
Â  Â  renderPointsGiven();
Â  }

Â  // Renderizar ranking (ordenado)
Â  function renderRanking() {
Â  Â  // Ordenar descendente por puntos
Â  Â  data.sort((a, b) => b.puntos - a.puntos);
Â  Â  rankingBody.innerHTML = "";
Â  Â  data.forEach((user, i) => {
Â  Â  Â  const tr = document.createElement("tr");
Â  Â  Â  tr.setAttribute("tabindex", "0");
Â  Â  Â  tr.setAttribute("role", "row");
Â  Â  Â  tr.dataset.nombre = user.nombre;

Â  Â  Â  const tdPos = document.createElement("td");
Â  Â  Â  tdPos.textContent = i + 1;
Â  Â  Â  tdPos.setAttribute("aria-label", "PosiciÃ³n");
Â  Â  Â  if (i === 0) tdPos.innerHTML = '<span class="medalla oro">ğŸ¥‡</span>';
Â  Â  Â  else if (i === 1) tdPos.innerHTML = '<span class="medalla plata">ğŸ¥ˆ</span>';
Â  Â  Â  else if (i === 2) tdPos.innerHTML = '<span class="medalla bronce">ğŸ¥‰</span>';

Â  Â  Â  const tdNombre = document.createElement("td");
Â  Â  Â  tdNombre.textContent = user.nombre;

Â  Â  Â  const tdPuntos = document.createElement("td");
Â  Â  Â  tdPuntos.textContent = user.puntos;
Â  Â  Â  tdPuntos.style.color = user.puntos >= 0 ? 'green' : 'red';
Â  Â  Â  if (user.puntos === 0) tdPuntos.style.color = '#666';

Â  Â  Â  tr.appendChild(tdPos);
Â  Â  Â  tr.appendChild(tdNombre);
Â  Â  Â  tr.appendChild(tdPuntos);

Â  Â  Â  rankingBody.appendChild(tr);
Â  Â  });
Â  }

Â  // Mostrar detalle puntos al hacer click en fila ranking
Â  rankingBody.addEventListener("click", (e) => {
Â  Â  let tr = e.target.closest("tr");
Â  Â  if (!tr) return;
Â  Â  const nombre = tr.dataset.nombre;
Â  Â  if (!nombre) return;
Â  Â  showDetails(nombre);
Â  });
Â  rankingBody.addEventListener("keydown", (e) => {
Â  Â  if (e.key === "Enter" || e.key === " ") {
Â  Â  Â  let tr = e.target.closest("tr");
Â  Â  Â  if (!tr) return;
Â  Â  Â  const nombre = tr.dataset.nombre;
Â  Â  Â  if (!nombre) return;
Â  Â  Â  showDetails(nombre);
Â  Â  }
Â  });

Â  // Mostrar detalle de puntos para una hermana
Â  function showDetails(nombre) {
Â  Â  detailsBody.innerHTML = "";
Â  Â  const user = data.find((d) => d.nombre === nombre);
Â  Â  if (!user) return;
Â  Â  if (user.detalles.length === 0) {
Â  Â  Â  const tr = document.createElement("tr");
Â  Â  Â  const td = document.createElement("td");
Â  Â  Â  td.colSpan = 4;
Â  Â  Â  td.textContent = "No hay registros de puntos para esta hermana.";
Â  Â  Â  td.style.fontStyle = "italic";
Â  Â  Â  tr.appendChild(td);
Â  Â  Â  detailsBody.appendChild(tr);
Â  Â  } else {
Â  Â  Â  user.detalles.forEach((det) => {
Â  Â  Â  Â  const tr = document.createElement("tr");
Â  Â  Â  Â  const tdFecha = document.createElement("td");
Â  Â  Â  Â  tdFecha.textContent = det.fecha;
Â  Â  Â  Â  const tdPuntos = document.createElement("td");
Â  Â  Â  Â  tdPuntos.textContent = det.puntos > 0 ? "+" + det.puntos : det.puntos;
Â  Â  Â  Â  tdPuntos.style.color = det.puntos > 0 ? "green" : "red";
Â  Â  Â  Â  const tdMotivo = document.createElement("td");
Â  Â  Â  Â  tdMotivo.textContent = det.motivo;
Â  Â  Â  Â  const tdAccion = document.createElement("td");

Â  Â  Â  Â  // BotÃ³n borrar sÃ³lo si modo admin
Â  Â  Â  Â  if (isAdmin) {
Â  Â  Â  Â  Â  const btnBorrar = document.createElement("button");
Â  Â  Â  Â  Â  btnBorrar.textContent = "Eliminar";
Â  Â  Â  Â  Â  btnBorrar.classList.add("show-in-admin");
Â  Â  Â  Â  Â  btnBorrar.addEventListener("click", () => {
Â  Â  Â  Â  Â  Â  if (confirm(`Â¿Eliminar el registro "${det.motivo}" (${det.puntos} puntos) de ${nombre}?`)) {
Â  Â  Â  Â  Â  Â  Â  removePoint(nombre, det.id);
Â  Â  Â  Â  Â  Â  Â  showDetails(nombre);
Â  Â  Â  Â  Â  Â  Â  renderRanking();
Â  Â  Â  Â  Â  Â  Â  renderPointsGiven();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  tdAccion.appendChild(btnBorrar);
Â  Â  Â  Â  }

Â  Â  Â  Â  tr.appendChild(tdFecha);
Â  Â  Â  Â  tr.appendChild(tdPuntos);
Â  Â  Â  Â  tr.appendChild(tdMotivo);
Â  Â  Â  Â  tr.appendChild(tdAccion);
Â  Â  Â  Â  detailsBody.appendChild(tr);
Â  Â  Â  });
Â  Â  }
Â  Â  detailsSection.classList.remove("hidden");
Â  Â  detailsSection.focus();
Â  }
Â  closeDetailsBtn.addEventListener("click", () => {
Â  Â  detailsSection.classList.add("hidden");
Â  });

Â  // Render lista de puntos dados (modo admin)
Â  function renderPointsGiven() {
Â  Â  if (!isAdmin) {
Â  Â  Â  pointsGivenList.innerHTML = "";
Â  Â  Â  return;
Â  Â  }
Â  Â  pointsGivenList.innerHTML = "";
Â  Â  data.forEach((user) => {
Â  Â  Â  user.detalles.forEach((det) => {
Â  Â  Â  Â  const div = document.createElement("div");
Â  Â  Â  Â  div.className = "list-item";
Â  Â  Â  Â  div.textContent = `${user.nombre}: ${det.puntos > 0 ? "+" : ""}${det.puntos} pts - ${det.motivo}`;
Â  Â  Â  Â  pointsGivenList.appendChild(div);
Â  Â  Â  });
Â  Â  });
Â  }

Â  // Render listas motivos admin
Â  function renderMotivos() {
Â  Â  gananListAdmin.innerHTML = "";
Â  Â  puntosGanadosMotivos.forEach((item, i) => {
Â  Â  Â  const div = document.createElement("div");
Â  Â  Â  div.className = "list-item";
Â  Â  Â  div.textContent = `+${item.puntos} - ${item.motivo}`;
Â  Â  Â  const btn = document.createElement("button");
Â  Â  Â  btn.textContent = "X";
Â  Â  Â  btn.title = "Eliminar motivo";
Â  Â  Â  btn.addEventListener("click", () => {
Â  Â  Â  Â  if (confirm(`Eliminar motivo para ganar puntos: "${item.motivo}"?`)) {
Â  Â  Â  Â  Â  puntosGanadosMotivos.splice(i, 1);
Â  Â  Â  Â  Â  saveMotivos();
Â  Â  Â  Â  Â  renderMotivos();
Â  Â  Â  Â  Â  renderInfoList();
Â  Â  Â  Â  }
Â  Â  Â  });
Â  Â  Â  div.appendChild(btn);
Â  Â  Â  gananListAdmin.appendChild(div);
Â  Â  });

Â  Â  pierdenListAdmin.innerHTML = "";
Â  Â  puntosPerdidosMotivos.forEach((item, i) => {
Â  Â  Â  const div = document.createElement("div");
Â  Â  Â  div.className = "list-item";
Â  Â  Â  div.textContent = `-${item.puntos} - ${item.motivo}`;
Â  Â  Â  const btn = document.createElement("button");
Â  Â  Â  btn.textContent = "X";
Â  Â  Â  btn.title = "Eliminar motivo";
Â  Â  Â  btn.addEventListener("click", () => {
Â  Â  Â  Â  if (confirm(`Eliminar motivo para perder puntos: "${item.motivo}"?`)) {
Â  Â  Â  Â  Â  puntosPerdidosMotivos.splice(i, 1);
Â  Â  Â  Â  Â  saveMotivos();
Â  Â  Â  Â  Â  renderMotivos();
Â  Â  Â  Â  Â  renderInfoList();
Â  Â  Â  Â  }
Â  Â  Â  });
Â  Â  Â  div.appendChild(btn);
Â  Â  Â  pierdenListAdmin.appendChild(div);
Â  Â  });
Â  }

Â  // Render info lista motivos (modo normal)
Â  function renderInfoList(ganan = true) {
Â  Â  pointsInfoList.innerHTML = "";
Â  Â  pointsInfoList.classList.remove("hidden");
Â  Â  let motivos = ganan ? puntosGanadosMotivos : puntosPerdidosMotivos;
Â  Â  motivos = motivos.slice().sort((a,b) => b.puntos - a.puntos);
Â  Â  motivos.forEach((item) => {
Â  Â  Â  const p = document.createElement("p");
Â  Â  Â  p.textContent = `${ganan ? "+" : "-"}${item.puntos} pts - ${item.motivo}`;
Â  Â  Â  pointsInfoList.appendChild(p);
Â  Â  });
Â  }

Â  // Botones mostrar info
Â  showPointsInfoBtn.addEventListener("click", () => {
Â  Â  const expanded = showPointsInfoBtn.getAttribute("aria-expanded") === "true";
Â  Â  if (expanded) {
Â  Â  Â  pointsInfoList.classList.add("hidden");
Â  Â  Â  showPointsInfoBtn.setAttribute("aria-expanded", "false");
Â  Â  Â  showPointsInfoBtn.textContent = "Â¿CÃ³mo se ganan puntos?";
Â  Â  } else {
Â  Â  Â  renderInfoList(true);
Â  Â  Â  pointsInfoList.classList.remove("hidden");
Â  Â  Â  showPointsInfoBtn.setAttribute("aria-expanded", "true");
Â  Â  Â  showPointsInfoBtn.textContent = "Ocultar motivos que ganan puntos";
Â  Â  Â  // TambiÃ©n ocultar otro botÃ³n
Â  Â  Â  pointsInfoList.style.border = `2px solid var(--lila)`;
Â  Â  }
Â  });
Â  showPointsLostBtn.addEventListener("click", () => {
Â  Â  const expanded = showPointsLostBtn.getAttribute("aria-expanded") === "true";
Â  Â  if (expanded) {
Â  Â  Â  pointsInfoList.classList.add("hidden");
Â  Â  Â  showPointsLostBtn.setAttribute("aria-expanded", "false");
Â  Â  Â  showPointsLostBtn.textContent = "Â¿CÃ³mo se pierden puntos?";
Â  Â  } else {
Â  Â  Â  renderInfoList(false);
Â  Â  Â  pointsInfoList.classList.remove("hidden");
Â  Â  Â  showPointsLostBtn.setAttribute("aria-expanded", "true");
Â  Â  Â  showPointsLostBtn.textContent = "Ocultar motivos que pierden puntos";
Â  Â  Â  pointsInfoList.style.border = `2px solid var(--lila)`;
Â  Â  }
Â  });

Â  // Form agregar puntos
Â  formAddPoints.addEventListener("submit", async (e) => {
Â  Â  e.preventDefault();
Â  Â  const nombre = nameInput.value.trim();
Â  Â  const puntos = parseInt(pointsInput.value);
Â  Â  const motivo = reasonInput.value.trim();
Â  Â  if (!nombre || isNaN(puntos) || !motivo) return alert("Completa todos los campos para agregar puntos.");
Â  Â  await addPoints(nombre, puntos, motivo);
Â  Â  nameInput.value = "";
Â  Â  pointsInput.value = "";
Â  Â  reasonInput.value = "";
Â  });

Â  // Form agregar motivo ganar puntos
Â  formGanan.addEventListener("submit", (e) => {
Â  Â  e.preventDefault();
Â  Â  const mot = gananMotivoInput.value.trim();
Â  Â  const pts = parseInt(gananPuntosInput.value);
Â  Â  if (!mot || !pts) return alert("Completa motivo y puntos para agregar.");
Â  Â  puntosGanadosMotivos.push({ motivo: mot, puntos: pts });
Â  Â  gananMotivoInput.value = "";
Â  Â  gananPuntosInput.value = "";
Â  Â  saveMotivos();
Â  Â  renderMotivos();
Â  Â  renderInfoList(true);
Â  });

Â  // Form agregar motivo perder puntos
Â  formPierden.addEventListener("submit", (e) => {
Â  Â  e.preventDefault();
Â  Â  const mot = pierdenMotivoInput.value.trim();
Â  Â  const pts = parseInt(pierdenPuntosInput.value);
Â  Â  if (!mot || !pts) return alert("Completa motivo y puntos para agregar.");
Â  Â  puntosPerdidosMotivos.push({ motivo: mot, puntos: pts });
Â  Â  pierdenMotivoInput.value = "";
Â  Â  pierdenPuntosInput.value = "";
Â  Â  saveMotivos();
Â  Â  renderMotivos();
Â  Â  renderInfoList(false);
Â  });

Â  // Init load
Â  window.addEventListener('load', loadData);
Â  renderRanking();
Â  renderMotivos();

Â  // Por defecto modo normal
Â  adminPanel.classList.add("hidden");
Â  detailsSection.classList.add("hidden");
Â  pointsInfoList.classList.add("hidden");

})();
</script>

</body>
</html>
